--- RCPTT testcase ---
Format-Version: 1.0
Context-Type: org.eclipse.rcptt.ctx.ecl
Element-Name: Preferences
Element-Type: context
Element-Version: 2.0
Id: _tIpJwP9tEeiDKs20GBwclA
Runtime-Version: 2.4.0.201812130013
Save-Time: 12/20/18 4:09 PM

------=_.ecl.context-718f04b4-ed39-33e3-af62-0995e4561998
Content-Type: text/ecl
Entry-Name: .ecl.context

proc "close-window-if-open" [val windowName] {
	log [concat "Must close Window " $windowName]

	try {
		get-window $windowName | close
	} -catch {
		log [concat "Window " $windowName " not open"]
	}
}
proc "get-first-preference-item" {
	close-window-if-open [ t preferences ]
	get-preferences-menu | click
	with [get-window [ t preferences ]] {
		// get-tree | select ".*" | get-property path -raw | log
		get-tree | select ".*" | click
		// get-item -index 1 | log
		// get-item -index 1 | click
		get-tree | get-item -path Bezugskontakt | get-property "getParent().getSelection().TreeItem[0].getText()" | log
		get-tree | get-item -path Bezugskontakt | get-property "getParent().getSelection().TreeItem[0].getText()" -raw
	}
}
global [val curPrefSection [get-first-preference-item]] -override
global [val curSubSection "" ] -override
global [val curPath "" ] -override
close-window-if-open [ t preferences ]

proc "check-one-preference-item" [val prefName] {
   // prefName as seen in the CSV file
    if [$prefName | str | matches "2,.*"] {
		global [val curSubSection [ replaceFirst $curPath ".*/" ""] ] -override
	    global [val  curPath [ concat $curPrefSection "/" $curSubSection [ replaceFirst $prefName "2," "/"] ] ] -override
	    global [val  curPath [ concat $curPrefSection "/" $curSubSection "/" [ replaceFirst $prefName "2," ""] ] ] -override
   		global [val  curFullPath    [ concat $curPath ".png"   ] ] -override
	} -else {
	    global [val  curPath [ replaceFirst $prefName "0," "" ] ] -override
	    global [val  curPath [ replaceFirst $curPath "1," ".*/" ] ] -override
	    global [val  curPath [ replaceFirst $curPath "2," [concat $curPrefSection ".*" ] ] ] -override // only needed for mediport
	    if [$prefName | str | matches "^0,.*"] {
		   		global [val  curPrefSection [ replaceFirst $prefName "0," "" ] ] -override
		   		global [val  curFullPath    [ concat $curPrefSection ".png"   ] ] -override
			} -else {
		   		global [val  curFullPath    [ concat
		   		[ $curPrefSection ]
		   		 "/"
		   		[ replaceAll $curPath "\W" "_" ]
		   		".png"
		   		]] -override
			} -else {
			global [val curSubSection "" ] -override
		}
	}
    global [val  imgName [ 
   		concat  $resultsDir
   		    "images/preferences/"
	   	 	[$curFullPath
    	] ] ] -override
   
	concat "save-screenshot: " $imgName | log
	get-preferences-menu | click
	with [get-window [ t preferences ]] {
		with [get-tree] {
			expand-all | select $curPath | key-type Down | log
			get-window [ t preferences ] | get-object |save-screenshot -out [ replaceAll $imgName "/___" "/" ]
		}
		get-button [ t apply_and_close ] | click
	}
}

proc "visit-all-preferences" {
	read-lines $preferencesCsvFile | foreach [val item] {
		if [$item | str | matches "^_indent.*"] {
			log "Skipping first line"
		} -else {
			check-one-preference-item $item
		}
	}
}

------=_.ecl.context-718f04b4-ed39-33e3-af62-0995e4561998--

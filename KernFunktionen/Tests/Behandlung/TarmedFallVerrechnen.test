--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _QPqdkBNIEemmeedSb1JQew,_LkBSkBsDEembU9g-6bJhVg,_jOjx0CCAEem06Mv2pVmYtA,_7pLWIBQVEemEb8FG0wciYA
Element-Name: TarmedFallVerrechnen
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _gN-zEBNWEemmeedSb1JQew
Runtime-Version: 2.4.1.201903190000
Save-Time: 4/3/19 2:11 PM
Testcase-Type: ecl

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content

// requires ImportSwissMediBase and BasicMandanten or demoDB run before
elexisLogMayNotContain "java.lang.OutOfMemoryError"
global [val testPatFamilyName "Bernasconi"] -override
global [val testPatFirstName "Antonio"] -override
concat "TarmedFallVerrechnen " $testPatFirstName " " $testPatFamilyName | log

// First we check that the tarmed and blocks are correctly imported
open-window-by-name [ t leistungen ]
select-tarmed-leistung | assert-true

OpenAndResetStartPerspektive
ChangeMandant [concat [ GetPraxisProperty praxis.mandant.2.Name ] ".*" ]

SetRightToDeleteCase
OpenAndResetStartPerspektive
ConfigureHilotecODF_TextVerarbeitung

OpenAndResetStartPerspektive
if [SelectPatient $testPatFamilyName $testPatFirstName | eq false] {
	PatientenErstellen $testPatFamilyName $testPatFirstName true "30.3.1990" "Nebenstrasse 33" 3320 Elexiskon "055 323 45 67"
}

if [FallOffen -caseLaw [ t case_KVG ] -startDate "201.*"] {
	log "Offenen Fall KVG gefunden"
} -else {
	FallZuPatientErstellen -caseLaw [ t case_KVG ] -caseReason [ t reason_KVG ] -startDate "20.8.2018"
	log "Fall KVG 20.8.2018 erstellt"
}
SelectFall  [ t case_KVG ] "201"
if [ HasKonsSelected | eq false] {
	kons-erstellen [ concat "BasisTests für " $testPatFamilyName " mit KVG" ]
} -else {
	log "HasKonsSelected returned true"
}

let [val fullName [ concat $testPatFamilyName " " $testPatFirstName ".*" ] ] {
	get-view [ t Patientendetails ] | get-editbox  | set-focus
	get-eclipse-window | gen-screenshot [ concat $imagesDir "TarmedFallVerrechnen_" $fullName ".png"]
	get-view [ t Patientendetails ] | get-label $fullName | get-property caption | matches $fullName | verify-true
}

// Items added/checked must be the same in TarmedFallVerrechnen and CheckTarmed Fall
kons-add-complementary 1255
kons-add-tarmed [ concat "10.0010" ] // "Klinische Geruchsprüfung, beidseitig" 
kons-add-tarmed [ concat "23.0010" ] // Untersuchung der Mammae KVGSA

kons-add-artikelstamm -item_short Losartan -item_long "LOSARTAN.*7 Stk.*" //7680582930020
kons-add-artikelstamm -item_short Metoprolol -item_long ".*30 Stk.*" //7680591310011

kons-add-block  -blockName "kons plus (KVG)" -expectedItemsAdded 4 // 00.0010 00.0015 00.0026 00.0030

// kons-add-eigenleistung
kons-neue-diagnose [ t kons_diagnose.1.reiter ] [ t kons_diagnose.1.item ]

FallSetVersicherungsNummer
AktuellenFallVerrechnen

// AbrechnungsSystemKonfigurieren
// Des muss eine Bankverbindung mit einem Kontakt erstellt werden!!
ImportHilotecODF_Vorlagen  [ concat $rcpttDir "vorlagen/TR44_S1.odt" ]
ImportHilotecODF_Vorlagen  [ concat $rcpttDir "vorlagen/TR44_S2.odt" ]
ImportHilotecODF_Vorlagen  [ concat $rcpttDir "vorlagen/Tarmedrechnung_S1.odt" ]
ImportHilotecODF_Vorlagen  [ concat $rcpttDir "vorlagen/Tarmedrechnung_S2.odt" ]
ImportHilotecODF_Vorlagen  [ concat $rcpttDir "vorlagen/Tarmedrechnung_EZ.odt" ]

RechnungAusgeben -patient $testPatFamilyName
elexisLogMayNotContain "java.lang.OutOfMemoryError"
// Ende
//
------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--

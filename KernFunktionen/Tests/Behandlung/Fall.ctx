--- RCPTT testcase ---
Format-Version: 1.0
Context-Type: org.eclipse.rcptt.ctx.ecl
Element-Name: Fall
Element-Type: context
Element-Version: 2.0
Id: _p5Ui8P79EeiFyvHqIglmCA
Runtime-Version: 2.4.0.201901240010
Save-Time: 2/10/19, 6:33 PM

------=_.ecl.context-718f04b4-ed39-33e3-af62-0995e4561998
Content-Type: text/ecl
Entry-Name: .ecl.context

proc "set-date-picker-date" [val window ] [ val labelBefore -input ] [ val "date" ] {
	concat "set-date-picker-date: " $date| log
	global [ val myCombo [  get-window $window | get-editbox -after [get-label $labelBefore ] ]] -override
	/*
	with [get-window "nouveau cas"] {
    get-label[ t dlg_new_case_startDate ] | get-property caption | equals[ t dlg_new_case_startDate ] | verify-true
    get-editbox -after [get-label "Créer un nouveau cas"] | get-property className 
        | equals "org.eclipse.swt.widgets.Text" | verify-true
        get-window "nouveau cas" | get-editbox -after [get-label "Créer un nouveau cas"] | get-property text 
    | equals "19.12.18" | verify-true
        */
        // Assertion of text failed: expected:<19.12.18> but was:<0.0>.
	// get-window $window | get-editbox -after [get-label $labelBefore ] | get-property text | equals "19.12.18" | verify-true
    // $myCombo | getObject | invoke | setText $date
    // line above results in error: There is no open report node for command invoke "Spinner {*Wrong Thread*}"
  //  get-window $window | get-editbox -after [get-label $labelBefore ] | get-property text | equals  $date | verify-true	
	concat "At the moment I do not know how to set datePick date in " $window " after " $labelBefore " to " $date | log
}

proc "SetRightToDeleteCase" {
	get-preferences-menu | click
	with [get-window [ t preferences ] ] {
	    get-tree | select [ t select_roles_right ]
	    get-tree -after [get-link [t dlg_create_user_accounting_change ] ] | get-item -path  [ t right_delete_case ]
		  | get-property "values['u']" -raw | log
		if [ get-tree -after [get-link [t dlg_create_user_accounting_change ] ] | get-item -path  [ t right_delete_case ]
		  | get-property "values['u']" -raw | equals x | eq true ] {
			log "User has already the right"
		  } -else {
			log "Must git the user the right"
		    get-tree -after [get-link [t dlg_create_user_accounting_change ] ] | select [ t right_delete_case ] | double-click
		  }
	    get-button [ t apply_and_close ] | click
	}
}

proc DeleteSelectedCase {
	get-view [ t view_cases ] | click
	get-view [ t view_cases ] | get-table | get-menu -path  [ t btn_delete_case ] | click
}

proc FallZuPatientErstellenFallsNichtVorhanden [val caseLaw [t case_UVG ] ] [ val caseReason [ t reason_UVG ]  ] [val startDate "201.*"] [val endDate "01.08.2018"] {
	if [FallOffen -caseLaw $caseLaw -startDate $startDate ] {
		concat  "Offenen Fall " $caseLaw " gefunden für Startatum " $startDate
	} -else {
		FallZuPatientErstellen -caseLaw $caseLaw -caseReason $caseReason -startDate "20.04.2018"
	}
}
proc FallZuPatientErstellen [val caseLaw [t case_UVG ] ] [ val caseReason [ t reason_UVG ]  ] [val startDate "30.04.2018"] [val endDate "01.08.2018"] {
	open-window-by-name [ t view_cases ]
	get-view [ t view_cases ]| get-button [ t btn_create_new_case ] | click
	wait 100
	
	with [get-window [ t dlg_new_case ] ] {
		concat "caseLaw: " $caseLaw  " caseReason: " $caseReason | log
		get-combo -after [get-label [ t dlg_new_case_caseMethod ] ] | select $caseLaw
		get-combo -after [get-label [ t dlg_new_case_caseReason ] ] | select $caseReason
		set-date-picker-date [ t dlg_new_case ] [ t dlg_new_case_startDate ] $startDate
		set-date-picker-date [ t dlg_new_case ] [ t dlg_new_case_endDate ] $endDate
		concat $imagesDir "Fall_" $caseLaw "_" $startDate "_created.png" | log
		get-eclipse-window | gen-screenshot [concat $imagesDir "Fall_" $caseLaw "_" $startDate "_created.png"]
		get-button  [ t ok] | click
	}
}

proc SelectFall [val caseLaw] [val startDate] {
	let [ val searchPattern [ concat $caseLaw ".*" $startDate ".*"] ] {
		get-view [ t view_cases ] | get-table | select $searchPattern | click
	}
}

proc FallOffen [val caseLaw] [val startDate] {
	let [val searchPattern [concat ".*" $caseLaw ".*"]] {
		try {
			concat "MySearchpattern is: " $searchPattern | log
			get-view [ t view_cases ] | get-table | get-item $searchPattern | get-property caption
			get-view [ t view_cases ] | get-table | get-item $searchPattern | select-item
			bool true  // 0 stands for true
		} -catch {
			bool false // 1 stands for false
		}
	}
}

proc AktuellenFallVerrechnen {
	get-view [ t view_cases ] | get-table | get-menu -path [ t btn_create_invoice ] | click
    try {
		get-window [ t error ] | get-label -index 1 |  get-property caption -raw | log
		log "AktuellenFallVerrechnen: Failed. See message above" -severity error
    } -catch {
		log "Catched error"
    }
	// get-window [ t error ] | verify-false
}

global [val auf_id 1 ] -override
proc "FallErzeugeAUF" [ val percentage 100 ] [ val reason "RCPTT Test-Grund" ] [ val comment "" ] [ val startDate "" ] [ val endDate ""]  {
	concat "FallErzeugeAUF. Warum ist hier manchmal kein Fall ausgewählt? " $auf_id | log
    get-eclipse-window | gen-screenshot [concat $imagesDir "AUF-" $auf_id "-before-create.png"]
	with [get-view AUF] {
	    click
	    get-button "Eine neue AUF erstellen" | click
	}
	with [get-window "Arbeitsunfähigkeit"] {
	    with [get-editbox -after [get-label Grund]] {
	        set-text $percentage
	    }
	    with [get-editbox -after [get-label Grund] -index 1] {
	        set-text $reason
	    }
	    get-editbox -after [get-label "ggf. Zusätzliche Angaben"] | set-text $comment
	    get-eclipse-window | gen-screenshot [concat $imagesDir "AUF-" $auf_id ".png"]
		global [val auf_id [  $auf_id | plus 1 ] ] -override
	    get-button OK | click
	}
}
proc "ErzeugeBriefZuAUT" [ val reason ".+" ] [ val adrName "Aquilana" ] [ val adrPostalcode "5401" ] {
	with [get-view AUF] {
		// Select first matching
	    get-table | select [ concat ".*" $reason ".*" ]
	    get-button "Ein Fenster mit einer Druckansicht der gewÃ¤hlten AUF Öffnen" | click
	}
	with [get-window "Kontakt auswählen"] {
	    get-table | select  [ concat ".*" $adrName ".*"  $adrPostalcode ".*" ]
	    get-button OK | click
	}
}

proc "FallSetVersicherungsNummer" [ val nummer 123456 ] {
	get-view "Fälle" | get-table | select ".*" | double-click
	get-view Fall | get-editbox -after [get-label Versicherungsnummer] | set-text $nummer
}

// End
//
------=_.ecl.context-718f04b4-ed39-33e3-af62-0995e4561998--
